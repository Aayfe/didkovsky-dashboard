<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>didkovsky.cz — Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{
--bg:#0b0d10;
--panel:rgba(255,255,255,0.04);
--panel2:rgba(255,255,255,0.06);
--text:rgba(255,255,255,0.92);
--muted:rgba(255,255,255,0.62);
--line:rgba(255,255,255,0.10);
--radius:18px;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--text)}
.wrap{padding:40px 50px 80px}
header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--line);padding-bottom:20px}
.brand{font-weight:600}
.btn{padding:8px 14px;border-radius:999px;border:1px solid var(--line);background:transparent;color:var(--text);cursor:pointer}
.btn:hover{background:var(--panel2)}
.hidden{display:none}
.dashboard{margin-top:40px;display:grid;grid-template-columns:260px 1fr;gap:24px}
.sidebar,.content{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius)}
.sidebar{padding:20px}
.sidebar a{display:block;padding:8px 10px;border-radius:12px;color:var(--muted)}
.sidebar a:hover{background:var(--panel2);color:var(--text)}
.content{padding:24px}
.card{background:var(--panel2);padding:16px;border-radius:14px;margin-bottom:14px}
.modalBack{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.modalBack.open{display:flex}
.modal{background:#111;border:1px solid var(--line);padding:20px;border-radius:20px;width:420px}
.input{width:100%;padding:10px;border-radius:12px;border:1px solid var(--line);background:#111;color:white;margin-bottom:10px}
</style>
</head>
<body>
<div class="wrap">
<header>
<div class="brand">Jakub Didkovský</div>
<div id="topNav"><button class="btn" onclick="openLogin()">Login</button></div>
</header>

<section id="landing">
<h1>Soukromý dashboard</h1>
<button class="btn" onclick="openLogin()">Přihlásit se</button>
</section>

<section id="app" class="hidden">
<div class="dashboard">
<div class="sidebar">
<a href="#" onclick="showOverview()">Přehled</a>
<a href="#" onclick="showUsers()">Uživatelé</a>
<div class="card" style="margin-top:20px">
<div id="who">—</div>
<div id="role"></div>
</div>
</div>
<div class="content" id="view"></div>
</div>
</section>

<div class="modalBack" id="loginModal">
<div class="modal">
<h3>Přihlášení</h3>
<input class="input" id="email" placeholder="Email" />
<input class="input" id="pass" type="password" placeholder="Heslo" />
<button class="btn" onclick="doLogin()">Login</button>
<div id="loginHint" style="margin-top:10px;color:#ff6b6b"></div>
</div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://jfvywczxlqwpmoivfipi.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_fmIDjWp5Oi_7cbZt4-80Jw_sSdThg2N";
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentProfile = null;

function openLogin(){document.getElementById('loginModal').classList.add('open')}
function closeLogin(){document.getElementById('loginModal').classList.remove('open')}

async function doLogin(){
const email=document.getElementById('email').value.trim();
const password=document.getElementById('pass').value;
const {data,error}=await supabase.auth.signInWithPassword({email,password});
if(error){document.getElementById('loginHint').innerText=error.message;return}
closeLogin();
loadProfile(data.user.id);
}

async function loadProfile(id){
const {data}=await supabase.from('profiles').select('*').eq('id',id).single();
if(!data){alert('Profil nenalezen');return}
currentProfile=data;
enterApp();
}

function enterApp(){
document.getElementById('landing').classList.add('hidden');
document.getElementById('app').classList.remove('hidden');
document.getElementById('topNav').innerHTML='<button class="btn" onclick="logout()">Logout</button>';
document.getElementById('who').innerText=currentProfile.email;
document.getElementById('role').innerText=currentProfile.role;
showOverview();
}

async function logout(){
await supabase.auth.signOut();
location.reload();
}

function showOverview(){
document.getElementById('view').innerHTML=`<h2>Přehled</h2><div class="card">Vítej v dashboardu.</div>`;
}

async function showUsers(){
if(currentProfile.role!=='owner'){document.getElementById('view').innerHTML='<div class="card">Nemáš oprávnění</div>';return}
const {data}=await supabase.from('profiles').select('email,role');
let html='<h2>Uživatelé</h2><div class="card">';
data.forEach(u=>{html+=`<div>${u.email} — ${u.role}</div>`});
html+='</div>';
document.getElementById('view').innerHTML=html;
}

window.addEventListener('load',async()=>{
const {data}=await supabase.auth.getSession();
if(data.session){loadProfile(data.session.user.id)}
});
</script>
</body>
</html>
